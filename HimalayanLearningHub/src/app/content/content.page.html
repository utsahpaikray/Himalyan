<div class="container-fluid">
  <header
    class="d-flex align-items-center justify-content-between p-3 bg-light shadow-sm"
  >
    <button (click)="goBack()" class="btn btn-outline-primary">
      <i class="fas fa-arrow-left me-2"></i> Back
    </button>
    <h1 class="h3 mb-0 text-primary">{{ topicName }}</h1>
  </header>

  <main class="py-4">
    <div *ngFor="let section of contentItems" class="card mb-3">
      <div
        class="card-header d-flex justify-content-between align-items-center cursor-pointer"
        (click)="toggleSection(section)"
      >
        <h2 class="h5 mb-0">{{ section.title }}</h2>
        <i
          class="fas"
          [class.fa-chevron-down]="!section.show"
          [class.fa-chevron-up]="section.show"
        ></i>
      </div>
      <!-- <pre>{{section | json}}</pre> -->
      <div class="card-body" *ngIf="section.show">
        <div *ngFor="let item of section.items" class="mb-3">
          <div [ngSwitch]="item.type">
            <!-- {{item.type}} -->
            <div *ngSwitchCase="'note'">
              <h3 class="card-title text-primary">{{ item.title }}</h3>
              <div
                class="card-text"
                [innerHTML]="item.content | safeHtml"
              ></div>
            </div>

            <div
              *ngSwitchCase="'long-question'"
              class="cursor-pointer"
              (click)="toggleAnswer(item)"
            >
              <h3 class="card-title text-success">{{ item.question }}</h3>
              <div
                *ngIf="item.showAnswer"
                class="mt-3 pt-3 border-top border-success text-success fw-bold"
              >
                <ul class="list-disc list-inside text-lg space-y-2">
                  <li *ngFor="let step of extractStepsFromText(item.answer)">
                    {{ step }}
                  </li>
                </ul>
                <!-- <p>{{ item.answer }}</p> -->
              </div>
            </div>

            <div
              *ngSwitchCase="'medium-questions'"
              class="cursor-pointer"
              (click)="toggleAnswer(item)"
            >
              <h3 class="card-title text-success">{{ item.question }}</h3>
              <div
                *ngIf="item.showAnswer"
                class="mt-3 pt-3 border-top border-success text-success fw-bold"
              >
                <p>{{ item.answer }}</p>
              </div>
            </div>
            <div
              *ngSwitchCase="'short-question'"
              class="cursor-pointer"
              (click)="toggleAnswer(item)"
            >
              <h3 class="card-title text-success">{{ item.question }}</h3>
              <div
                *ngIf="item.showAnswer"
                class="mt-3 pt-3 border-top border-success text-success fw-bold"
              >
                <p>{{ item.answer }}</p>
              </div>
            </div>

            <div *ngSwitchCase="'mcq'">
              <div class="cursor-pointer" (click)="toggleAnswer(item)">
                <strong class="text-warning">{{ item.question }}</strong>
              </div>
              <div *ngIf="item.showAnswer" class="mt-3">
                <div
                  *ngFor="let option of item.options; let i = index"
                  class="form-check mb-2 p-3 border rounded cursor-pointer"
                  [class.bg-primary-subtle]="item.selectedOption === option"
                  [class.border-primary]="item.selectedOption === option"
                  [class.bg-success-subtle]="item.isAnswered && option === item.answer"
                  [class.border-success]="item.isAnswered && option === item.answer"
                  [class.bg-danger-subtle]="item.isAnswered && item.selectedOption === option && option !== item.answer"
                  [class.border-danger]="item.isAnswered && item.selectedOption === option && option !== item.answer"
                  (click)="selectOption(item, option)"
                >
                  <input
                    class="form-check-input"
                    type="radio"
                    [name]="'mcq-' + item.question"
                    [value]="option"
                    [checked]="item.selectedOption === option"
                  />
                  <label class="form-check-label">{{ option }}</label>
                </div>
              </div>
              <div
                *ngIf="item.showAnswer && item.isAnswered"
                class="mt-4 pt-3 border-top text-dark"
              >
                <strong class="text-success">Answer: {{ item.answer }}</strong>
              </div>
            </div>

            <div *ngSwitchCase="'media'">
              <h3 class="card-title text-info">{{ item.title }}</h3>
              <div *ngIf="item.mediaType === 'audio'">
                <audio controls class="w-100 mt-2 rounded">
                  <source [src]="item.mediaUrl" type="audio/mpeg" />
                  Your browser does not support the audio element.
                </audio>
              </div>
              <div *ngIf="item.mediaType === 'video'">
                <video controls class="w-100 mt-2 rounded">
                  <source [src]="item.mediaUrl" type="video/mp4" />
                  Your browser does not support the video tag.
                </video>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div
      *ngIf="hasQuiz"
      class="text-center p-4 bg-light border border-primary rounded"
    >
      <h2 class="h4 mb-3">Ready for a Quiz?</h2>
      <p class="mb-4">Test your knowledge on this topic!</p>
      <button (click)="startQuiz()" class="btn btn-primary">Start Quiz</button>
    </div>
  </main>
</div>
